---

title: Data augmentation


keywords: fastai
sidebar: home_sidebar

summary: "Functions to augment the user's dataset with information from official sources."
description: "Functions to augment the user's dataset with information from official sources."
nb_path: "00_augmentation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_augmentation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-augmentation-as-a-transformer">Data augmentation as a transformer<a class="anchor-link" href="#Data-augmentation-as-a-transformer"> </a></h2><p>The package <code>scikit-learn</code> makes use of the concept of transformer, an object in python that adapts the transformation at hand to the training data, and then deploys it on the testing data. These transformers can be used as part of a pipeline.</p>
<p>In order to ensure maximumm compatibility with packages that are widely used, <code>gingado</code>'s data augmentation function are implemented as an object that are funcional on their own.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Interesting! Now moving on to b the stories também.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AugmentSDMX" class="doc_header"><code>class</code> <code>AugmentSDMX</code><a href="https://github.com/dkgaraujo/gingado/tree/main/gingado/augmentation.py#L12" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AugmentSDMX</code>(<strong><code>sources</code></strong>=<em><code>{'BIS': 'all'}</code></em>, <strong><code>variance_threshold</code></strong>=<em><code>None</code></em>, <strong><code>backend</code></strong>=<em><code>'memory'</code></em>, <strong><code>verbose</code></strong>=<em><code>True</code></em>) :: <code>BaseEstimator</code></p>
</blockquote>
<p>Base class for all estimators in scikit-learn.</p>
<h2 id="Notes">Notes<a class="anchor-link" href="#Notes"> </a></h2><p>All estimators should specify all the parameters that can be set
at the class level in their <code>__init__</code> as explicit keyword
arguments (no <code>*args</code> or <code>**kwargs</code>).</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As mentioned above, <code>gingado</code>'s transformers are built to be compatible with <code>scikit-learn</code>. The code below checks whether this is achieved.</p>
<p>First, we create the example dataset comprising the foreign exchange rate of a number of currencies to the Euro. The Brazilian Real is chosen for this example as the dependent variable.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">gingado.utils</span> <span class="kn">import</span> <span class="n">load_EURFX_data</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">load_EURFX_data</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;BRL&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, the data augmentation object provided by <code>gingado</code> adds more data. In this case, for brevity only one dataflow from one source is listed. If users want to add more SDMX sources, simply add more keys to the dictionary. And if users want data from all dataflows from a given source (provided the keys and parameters such as frequency and dates are matched), the value should be set to <code>'all'</code>, as in <code>{'ECB': ['CISS'], 'BIS': 'all'}</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_augm</span> <span class="o">=</span> <span class="n">AugmentSDMX</span><span class="p">(</span><span class="n">sources</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ECB&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;CISS&#39;</span><span class="p">]})</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2022-05-24 02:06:48,523 pandasdmx.reader.sdmxml - INFO: Use supplied dsd=… argument for non–structure-specific message
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Querying data from ECB&#39;s dataflow &#39;CISS&#39; - Composite Indicator of Systemic Stress...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The number of features just went from </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">X_augm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> with one dataflow!</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="p">,</span> <span class="n">X_augm</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
The number of features just went from 7 to 29 with one dataflow!

                 AUD     CAD     CHF     GBP     JPY     SGD     USD  \
TIME_PERIOD                                                           
2003-01-02   1.8554  1.6422  1.4528  0.6520  124.40  1.8188  1.0446   
2003-01-03   1.8440  1.6264  1.4555  0.6500  124.56  1.8132  1.0392   
2003-01-06   1.8281  1.6383  1.4563  0.6495  124.40  1.8210  1.0488   
2003-01-07   1.8160  1.6257  1.4565  0.6496  124.82  1.8155  1.0425   
2003-01-08   1.8132  1.6231  1.4586  0.6495  124.90  1.8102  1.0377   

             ECB__CISS_D__AT__Z0Z__4F__EC__SS_CIN__IDX  \
TIME_PERIOD                                              
2003-01-02                                    0.023427   
2003-01-03                                    0.021899   
2003-01-06                                    0.020801   
2003-01-07                                    0.019738   
2003-01-08                                    0.019947   

             ECB__CISS_D__BE__Z0Z__4F__EC__SS_CIN__IDX  \
TIME_PERIOD                                              
2003-01-02                                    0.047823   
2003-01-03                                    0.043292   
2003-01-06                                    0.039924   
2003-01-07                                    0.038084   
2003-01-08                                    0.040338   

             ECB__CISS_D__CN__Z0Z__4F__EC__SS_CIN__IDX  ...  \
TIME_PERIOD                                             ...   
2003-01-02                                         NaN  ...   
2003-01-03                                         NaN  ...   
2003-01-06                                         NaN  ...   
2003-01-07                                         NaN  ...   
2003-01-08                                         NaN  ...   

             ECB__CISS_D__U2__Z0Z__4F__EC__SS_BM__CON  \
TIME_PERIOD                                             
2003-01-02                                        NaN   
2003-01-03                                   0.032193   
2003-01-06                                        NaN   
2003-01-07                                        NaN   
2003-01-08                                        NaN   

             ECB__CISS_D__U2__Z0Z__4F__EC__SS_CI__IDX  \
TIME_PERIOD                                             
2003-01-02                                        NaN   
2003-01-03                                   0.132775   
2003-01-06                                        NaN   
2003-01-07                                        NaN   
2003-01-08                                        NaN   

             ECB__CISS_D__U2__Z0Z__4F__EC__SS_CIN__IDX  \
TIME_PERIOD                                              
2003-01-02                                    0.051668   
2003-01-03                                    0.056262   
2003-01-06                                    0.058146   
2003-01-07                                    0.059180   
2003-01-08                                    0.060996   

             ECB__CISS_D__U2__Z0Z__4F__EC__SS_CO__CON  \
TIME_PERIOD                                             
2003-01-02                                        NaN   
2003-01-03                                  -0.281764   
2003-01-06                                        NaN   
2003-01-07                                        NaN   
2003-01-08                                        NaN   

             ECB__CISS_D__U2__Z0Z__4F__EC__SS_EM__CON  \
TIME_PERIOD                                             
2003-01-02                                        NaN   
2003-01-03                                   0.146698   
2003-01-06                                        NaN   
2003-01-07                                        NaN   
2003-01-08                                        NaN   

             ECB__CISS_D__U2__Z0Z__4F__EC__SS_FI__CON  \
TIME_PERIOD                                             
2003-01-02                                        NaN   
2003-01-03                                   0.135404   
2003-01-06                                        NaN   
2003-01-07                                        NaN   
2003-01-08                                        NaN   

             ECB__CISS_D__U2__Z0Z__4F__EC__SS_FX__CON  \
TIME_PERIOD                                             
2003-01-02                                        NaN   
2003-01-03                                   0.036013   
2003-01-06                                        NaN   
2003-01-07                                        NaN   
2003-01-08                                        NaN   

             ECB__CISS_D__U2__Z0Z__4F__EC__SS_MM__CON  \
TIME_PERIOD                                             
2003-01-02                                        NaN   
2003-01-03                                   0.064231   
2003-01-06                                        NaN   
2003-01-07                                        NaN   
2003-01-08                                        NaN   

             ECB__CISS_D__US__Z0Z__4F__EC__SS_CI__IDX  \
TIME_PERIOD                                             
2003-01-02                                        NaN   
2003-01-03                                   0.249646   
2003-01-06                                        NaN   
2003-01-07                                        NaN   
2003-01-08                                        NaN   

             ECB__CISS_D__US__Z0Z__4F__EC__SS_CIN__IDX  
TIME_PERIOD                                             
2003-01-02                                    0.123014  
2003-01-03                                    0.133552  
2003-01-06                                    0.145265  
2003-01-07                                    0.151408  
2003-01-08                                    0.161252  

[5 rows x 29 columns]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It can also be part of a <code>Pipeline</code> object, which enables the use of grid search and other parameter search techniques:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span>
<span class="kn">from</span> <span class="nn">gingado.augmentation</span> <span class="kn">import</span> <span class="n">AugmentSDMX</span>

<span class="n">lags</span><span class="o">=</span><span class="mi">2</span>
<span class="n">jump</span><span class="o">=</span><span class="mi">5</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;augmentation&#39;</span><span class="p">,</span> <span class="n">AugmentSDMX</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">KNNImputer</span><span class="p">()),</span>
    <span class="c1">#(&#39;regressor&#39;, RandomForestRegressor())</span>
<span class="p">])</span>

<span class="n">pipeline</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="c1"># parameters = {</span>
<span class="c1">#     &#39;augmentation&#39;: (&#39;passthrough&#39;, AugmentSDMX(sources={&#39;BIS&#39;: &#39;WS_CBPOL_D&#39;})),</span>
<span class="c1">#     &#39;regressor__n_estimators&#39;: (&#39;10&#39;, &#39;20&#39;)</span>
<span class="c1"># }</span>

<span class="c1"># grid_search = GridSearchCV(pipeline, parameters, n_jobs=-1)</span>
<span class="c1"># grid_search.fit(X=X, y=y)</span>


<span class="c1"># best_parameters = grid_search.best_estimator_</span>
<span class="c1"># for param_name in sorted(parameters.keys()):</span>
<span class="c1">#     print(&quot;\t%s: %r&quot; % (param_name, best_parameters[param_name]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">best_parameters</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="k">for</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s2">: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">best_parameters</span><span class="p">[</span><span class="n">param_name</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Overall-scheme:">Overall scheme:<a class="anchor-link" href="#Overall-scheme:"> </a></h2><ul>
<li>Since sklearn <code>Pipeline</code> objects transform data into numpy arrays (and thus do not allow for things like looking at the index or title, etc), <code>gingado</code> will create a "workflow" object that:<ul>
<li>includes the data augmentation (useful to have pandas available!)</li>
<li>the sklearn pipeline is a component that lies in the "middle" of the pipeline</li>
<li>the documentation step benefits from the workflow retaining things like main dates, etc, so that it can also be used in the documentation.</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Other-functions">Other functions<a class="anchor-link" href="#Other-functions"> </a></h2><p>Most users will probably find it helpful to use the <code>DataAugment</code> transformer, which is compatible with <code>scikit-learn</code>, rather than the underlying functions. However, they are documented below in case their use might address some specific user need.</p>
<h2 id="Sources-of-data">Sources of data<a class="anchor-link" href="#Sources-of-data"> </a></h2><p><code>gingado</code> only lists official data sources by choice. This is meant to provide users with the trust that their dataset will be complemented by reliable sources. Unfortunately, it is not possible at this stage to include <em>all</em> official sources - let alone all reliable sources - because that requires substantial manual and maintenance work. <code>gingado</code> leverages the existence of the <a href="https://sdmx.org">Statistical Data and Metadata eXchange (SDMX)</a>, an organisation of official data sources that establishes common data and metadata formats, to download data that is relevant (and hopefully also useful) to users.</p>
<p>The function below from the package <a href="https://github.com/dkgaraujo/simpledmx">simpledmx</a> returns a list of codes corresponding to the data sources available to provide <code>gingado</code> users with data through SDMX.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">list_sdmx_sources</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="augm_with_sdmx" class="doc_header"><code>augm_with_sdmx</code><a href="https://github.com/dkgaraujo/gingado/tree/main/gingado/augmentation.py#L83" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>augm_with_sdmx</code>(<strong><code>df</code></strong>, <strong><code>freq</code></strong>, <strong><code>sources</code></strong>, <strong><code>variance_threshold</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Downloads relevant data from SDMX sources to complement the original dataset</p>
<p>Arguments:
  df: a pandas DataFrame
  freq: the frequency of the desired data from SDMX; for example, 'A' is annual
  sources: the list of SDMX sources or None; a list of possible sources can be obtained by running the function list_sdmx_sources()
  variance_threshold: a value larger than or equal to 0 or None, where 0 will lead to the removal of all data that does not vary across the dataset and None uses the scikit-learn default</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

